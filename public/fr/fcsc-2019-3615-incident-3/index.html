

<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>[FCSC 2019] - 3615 Incident (3/3) - Blog - hashp4</title><meta name="Description" content="Solution du **dernier** challenge de la série `3615 Incident` paru lors du FCSC 2019."><meta property="og:title" content="[FCSC 2019] - 3615 Incident (3/3)" />
<meta property="og:description" content="Solution du **dernier** challenge de la série `3615 Incident` paru lors du FCSC 2019." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hashp4.fr/fr/fcsc-2019-3615-incident-3/" /><meta property="og:image" content="https://hashp4.fr/fr/fcsc-2019-3615-incident-3/feature.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-09T00:00:00+00:00" /><meta property="og:site_name" content="hashp4" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://hashp4.fr/fr/fcsc-2019-3615-incident-3/feature.png" /><meta name="twitter:title" content="[FCSC 2019] - 3615 Incident (3/3)"/>
<meta name="twitter:description" content="Solution du **dernier** challenge de la série `3615 Incident` paru lors du FCSC 2019."/>
<meta name="twitter:site" content="@hashp4_"/>
<meta name="application-name" content="hashp4">
<meta name="apple-mobile-web-app-title" content="hashp4">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><meta name="twitter:creator" content="@hashp4_" /><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://hashp4.fr/fr/fcsc-2019-3615-incident-3/" /><link rel="prev" href="https://hashp4.fr/fr/fcsc-2019-3615-incident-2/" />
<link rel="stylesheet" href="/css/main.4cb370884f3eb79df5ec8943416884c6aa730a30ceff5cd62fd0872f24b6b68e.css" integrity="sha256-TLNwiE8&#43;t5317IlDQWiExqpzCjDO/1zWL9CHLyS2to4="><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/color.728a2655c4cc249649c041d72af6111f81a1b57cb4f99fc4323550b7f966e960.css" integrity="sha256-coomVcTMJJZJwEHXKvYRH4GhtXy0&#43;Z/EMjVQt/lm6WA="><link rel="stylesheet" href="/css/style.min.aadeb0d1e0db9fd05aaaa62285215f80238b1e906367e8936725dd7de8c1642f.css" integrity="sha256-qt6w0eDbn9BaqqYihSFfgCOLHpBjZ&#43;iTZyXdfejBZC8="><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[FCSC 2019] - 3615 Incident (3/3)",
        "inLanguage": "fr",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://hashp4.fr/fr/fcsc-2019-3615-incident-3/"
        },"image": ["https://hashp4.fr/images/Apple-Devices-Preview.png"],"genre": "posts","keywords": "Forensic, FCSC 2019, Volatility, Ransomware","wordcount":  1622 ,
        "url": "https://hashp4.fr/fr/fcsc-2019-3615-incident-3/","datePublished": "2023-12-09T00:00:00+00:00","dateModified": "2023-12-09T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "hashp4","logo": {
                    "@type": "ImageObject",
                    "url": "https://hashp4.fr/images/logo.png",
                    "width":  288 ,
                    "height":  288 
                }},"authors": [{
                        "@type": "Person",
                        "name": "hashp4"                    
                    }],"description": "Solution du **dernier** challenge de la série `3615 Incident` paru lors du FCSC 2019."
    }
    </script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('black' === 'light' || 'black' === 'dark' || 'black' === 'black') setTheme('black'), saveTheme('black'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/fr/" title="Blog - hashp4"><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/fr/whoami">🇫🇷 whoami </a><a class="menu-item" href="/fr/categories/article/">✒ Blog </a><a class="menu-item" href="/fr/projects/">📚 Projets </a><a class="menu-item" href="/fr/categories/writeup">🚩 Writeups </a><a class="menu-item" href="/fr/music/">🎵 Musique </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Choisir la langue">Français<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" title="Choisir la langue" id="language-select-desktop" onchange="location = this.value;"><option value="/fcsc-2019-3615-incident-3/">English</option><option value="/fr/fcsc-2019-3615-incident-3/" selected>Français</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-select" title="Changer de thème">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Changer de thème">
                        <option value="light">Clair</option>
                        <option value="dark">Sombre</option>
                        <option value="black">Noir</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/fr/" title="Blog - hashp4"><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/fr/whoami" title="">🇫🇷whoami</a><a class="menu-item" href="/fr/categories/article/" title="">✒Blog</a><a class="menu-item" href="/fr/projects/" title="">📚Projets</a><a class="menu-item" href="/fr/categories/writeup" title="">🚩Writeups</a><a class="menu-item" href="/fr/music/" title="">🎵Musique</a><a href="javascript:void(0);" class="menu-item theme-select" title="Changer de thème">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Changer de thème">
                    <option value="light">Clair</option>
                    <option value="dark">Sombre</option>
                    <option value="black">Noir</option>
                    <option value="auto">Auto</option>
                </select>
            </a><a href="javascript:void(0);" class="menu-item" title="Choisir la langue">Français<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" title="Choisir la langue" onchange="location = this.value;"><option value="/fcsc-2019-3615-incident-3/">English</option><option value="/fr/fcsc-2019-3615-incident-3/" selected>Français</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contenu</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-pushpin">Introduction </a></li>
    <li><a href="#1-étude-de-lalgorithme-de-chiffrement-">1. Étude de l&rsquo;algorithme de chiffrement 📋</a>
      <ul>
        <li><a href="#un-zoom-rapide-sur-ransomwarego-encore-oui">Un zoom rapide sur <code>ransomware.go</code> (encore oui)</a></li>
        <li><a href="#un-zoom-sur-filego">Un zoom sur <code>file.go</code></a></li>
      </ul>
    </li>
    <li><a href="#2-déchiffrement-du-fichier-data-">2. Déchiffrement du fichier <code>data</code> 🔓</a>
      <ul>
        <li><a href="#extraction-de-liv">Extraction de l&rsquo;IV</a></li>
        <li><a href="#déchiffrement-via-cyberchef-flemmard">Déchiffrement via Cyberchef <em>(flemmard)</em></a></li>
        <li><a href="#déchiffrement-via-python-street-cred">Déchiffrement via Python <em>(street cred++)</em></a></li>
      </ul>
    </li>
    <li><a href="#3-flag-">3. Flag 🚩</a></li>
    <li><a href="#bonus---retrouver-le-flag-sans-le-fichier-data-">BONUS - Retrouver le flag sans le fichier <code>data</code> 💡</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[FCSC 2019] - 3615 Incident (3/3)</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><span class="author fas fa-user-circle fa-fw"></span><span class='screen-reader-text'>  </span><a href='https://hashp4.fr/fr/authors/hashp4'>hashp4</a></span>
                </span>&nbsp;<span class="post-category">inclus dans </span>&nbsp;<span class="post-category">catégorie <a href="/fr/categories/writeup/"><i class="far fa-folder fa-fw"></i>Writeup</a></span>&nbsp;<span class="post-category">et</span>&nbsp;<span class="post-series">séries <a href=""><i class="far fa-list-alt fa-fw"></i></a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="09-12-2023">09-12-2023</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="09-12-2023">09-12-2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1622 mots&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="/fr/fcsc-2019-3615-incident-3/feature.png"
        srcset="/fr/fcsc-2019-3615-incident-3/feature.png, /fr/fcsc-2019-3615-incident-3/feature.png 1.5x, /fr/fcsc-2019-3615-incident-3/feature.png 2x"
        sizes="auto"
        alt="Solution du **dernier** challenge de la série `3615 Incident` paru lors du FCSC 2019."
        title="Solution du **dernier** challenge de la série `3615 Incident` paru lors du FCSC 2019." height="360"   width="1200" ></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenu</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-pushpin">Introduction </a></li>
    <li><a href="#1-étude-de-lalgorithme-de-chiffrement-">1. Étude de l&rsquo;algorithme de chiffrement 📋</a>
      <ul>
        <li><a href="#un-zoom-rapide-sur-ransomwarego-encore-oui">Un zoom rapide sur <code>ransomware.go</code> (encore oui)</a></li>
        <li><a href="#un-zoom-sur-filego">Un zoom sur <code>file.go</code></a></li>
      </ul>
    </li>
    <li><a href="#2-déchiffrement-du-fichier-data-">2. Déchiffrement du fichier <code>data</code> 🔓</a>
      <ul>
        <li><a href="#extraction-de-liv">Extraction de l&rsquo;IV</a></li>
        <li><a href="#déchiffrement-via-cyberchef-flemmard">Déchiffrement via Cyberchef <em>(flemmard)</em></a></li>
        <li><a href="#déchiffrement-via-python-street-cred">Déchiffrement via Python <em>(street cred++)</em></a></li>
      </ul>
    </li>
    <li><a href="#3-flag-">3. Flag 🚩</a></li>
    <li><a href="#bonus---retrouver-le-flag-sans-le-fichier-data-">BONUS - Retrouver le flag sans le fichier <code>data</code> 💡</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="introduction-pushpin" class="headerLink">
    <a href="#introduction-pushpin" class="header-mark"></a>Introduction &#x1f4cc;</h2><p>Le contexte reste le même que lors de la première partie et seconde partie. Une victime de plus est tombée sous le coup d’un rançongiciel. Le paiement de la rançon n’est pas envisagée vu le montant demandé. Nous sommes donc appelés pour essayer de restaurer les fichiers chiffrés.</p>
<p>Cette fois-ci, l&rsquo;objectif est de <strong>déchiffrer le fichier data ci-joint</strong>.</p>
<p>(La résolution de l&rsquo;épreuve s&rsquo;effectue toujours à l&rsquo;aide du fichier <code>mem.dmp.tar.xz</code>. Pour rappel, il s&rsquo;agit d&rsquo;une image mémoire de l&rsquo;ordinateur de la victime. Concrètement, celle-ci correspond au contenu de la mémoire volatile (<code>RAM</code>) au moment de l&rsquo;acquisition. De plus, nous avons à disposition le fichier <code>data</code> à déchiffrer.</p>
<h2 id="1-étude-de-lalgorithme-de-chiffrement-" class="headerLink">
    <a href="#1-%c3%a9tude-de-lalgorithme-de-chiffrement-" class="header-mark"></a>1. Étude de l&rsquo;algorithme de chiffrement 📋</h2><p>Pour pouvoir déchiffrer le fichier <code>data</code>, nous allons devoir étudier l&rsquo;algorithme de chiffrement mis en place par ce rançongiciel. Comme nous avons accès au code source, cela simplifie grandement le processus.</p>
<h3 id="un-zoom-rapide-sur-ransomwarego-encore-oui" class="headerLink">
    <a href="#un-zoom-rapide-sur-ransomwarego-encore-oui" class="header-mark"></a>Un zoom rapide sur <code>ransomware.go</code> (encore oui)</h3><p>Replongeons nous dans le fichier <a href="https://github.com/mauri870/ransomware/blob/master/cmd/ransomware/ransomware.go#L223" target="_blank" rel="noopener noreferrer">/cmd/ransomware/ransomware.go, ligne 223</a> cette fois ci.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Encrypt the file sending the content to temporary file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">err</span> <span class="p">=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Encrypt</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="s">&#34;enckey&#34;</span><span class="p">],</span> <span class="nx">tempFile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cmd</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">continue</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Nous pouvons constater que la fonction de chiffrement <code>Encrypt()</code> provient du fichier <code>file</code>. Elle semble prendre en paramètre la clé de chiffrement et un nom de fichier temporaire. Il est donc nécessaire d&rsquo;analyser ce que fais précisemment cette fameuse fonction.</p>
<h3 id="un-zoom-sur-filego" class="headerLink">
    <a href="#un-zoom-sur-filego" class="header-mark"></a>Un zoom sur <code>file.go</code></h3><p>Le fonctionnement de l&rsquo;algorithme de chiffrement employé par la fonction <code>Encrypt()</code> se trouve à partir de <a href="https://github.com/mauri870/ransomware/blob/master/cryptofs/file.go#L21" target="_blank" rel="noopener noreferrer">la ligne 21 du fichier cryptofs/file.go</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">file</span> <span class="o">*</span><span class="nx">File</span><span class="p">)</span> <span class="nf">Encrypt</span><span class="p">(</span><span class="nx">enckey</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">dst</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Create a 128 bits cipher.Block for AES-256
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">block</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">aes</span><span class="p">.</span><span class="nf">NewCipher</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">enckey</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// The IV needs to be unique, but not secure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">iv</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">aes</span><span class="p">.</span><span class="nx">BlockSize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">io</span><span class="p">.</span><span class="nf">ReadFull</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Reader</span><span class="p">,</span> <span class="nx">iv</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Get a stream for encrypt/decrypt in counter mode (best performance I guess)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">stream</span> <span class="o">:=</span> <span class="nx">cipher</span><span class="p">.</span><span class="nf">NewCTR</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">iv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Write the Initialization Vector (iv) as the first block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// of the dst writer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">dst</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">iv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Le première partie du code nous permet de constater l&rsquo;utilisation de l&rsquo;algorithme de chiffrement <code>AES-256</code>. Le chiffrement s&rsquo;effectue en <em>counter mode (CTR)</em>, observable un peu plus bas.</p>
<p>Le second partie du code, quant à elle, nous indique que l&rsquo;<code>IV</code> est <strong>le premier bloc</strong> du fichier chiffré. C&rsquo;est une bonne nouvelle pour nous. En effet, comme nous disposons des fichiers chiffrés et de la clé de chiffrement, il nous suffit d&rsquo;extraire l&rsquo;IV de ceux-ci pour pouvoir les déchiffrer.</p>
<h2 id="2-déchiffrement-du-fichier-data-" class="headerLink">
    <a href="#2-d%c3%a9chiffrement-du-fichier-data-" class="header-mark"></a>2. Déchiffrement du fichier <code>data</code> 🔓</h2><h3 id="extraction-de-liv" class="headerLink">
    <a href="#extraction-de-liv" class="header-mark"></a>Extraction de l&rsquo;IV</h3><p>Pour extraire l&rsquo;<code>IV</code> de <code>data</code>, nous pouvons utiliser <code>xxd</code> pour obtenir le contenu du fichier en hexadécimal et <code>fold</code> pour le découper en bloc de 32 caractères <em>(rappelez-vous, l&rsquo;IV est une chaine de 32 caractères hexadécimaux)</em>. Ensuite, nous pouvons utiliser <code>head</code> pour ne garder que le premier bloc à l&rsquo;aide de l&rsquo;option <code>-n 1</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ xxd -p data <span class="p">|</span> fold -b32 <span class="p">|</span> head -n <span class="m">1</span>                
</span></span><span class="line"><span class="cl">b627d24fc90dfe7ce421c43312dc2f2e
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ainsi, nous obtenons l&rsquo;<code>IV</code> correspondant à notre fichier <code>data</code> : <code>b627d24fc90dfe7ce421c43312dc2f2e</code></p>
<h3 id="déchiffrement-via-cyberchef-flemmard" class="headerLink">
    <a href="#d%c3%a9chiffrement-via-cyberchef-flemmard" class="header-mark"></a>Déchiffrement via Cyberchef <em>(flemmard)</em></h3><p>Pour déchiffrer notre fichier, nous pouvons nous aider de <a href="https://gchq.github.io/CyberChef/" target="_blank" rel="noopener noreferrer">Cyberchef</a>. Pour ce faire, il faut lui donner un entrée (<em>input</em>) le contenu du fichier chiffré (ici <em>data</em>) en hexadécimal. Pour ce faire nous pouvons utiliser <code>xxd</code>.</p>
<p><em>(⚠️ : n&rsquo;oublions pas de supprimer le contenu correspondant à l&rsquo;IV de notre fichier, sans quoi le déchiffrement ne marchera pas. Nous utilisons l&rsquo;outil <code>sed</code> pour le faire).</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ xxd -p -c0 data <span class="p">|</span> sed <span class="s1">&#39;s/b627d24fc90dfe7ce421c43312dc2f2e//g&#39;</span>
</span></span><span class="line"><span class="cl">abf961d204bf8c684dff45fc658d5bba4da43a8 <span class="o">[</span>...<span class="o">]</span>7febfd28649595e720a8
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>Le résultat étant trop grand, je n&rsquo;écris ici que les caractères correspondant au début et à la fin du fichier.</em></p>
<p>Nous devons ensuite copier/coller ce résultat dans Cyberchef, sélectionner la recette <code>AES Decrypt</code> et rentrer les paramètres suivants :</p>
<ul>
<li><strong>Key (UTF-8) :</strong> <code>95511870061fb3a2899aa6b2dc9838aa</code></li>
<li><strong>IV (HEX) :</strong> <code>b627d24fc90dfe7ce421c43312dc2f2e</code></li>
<li><strong>Mode :</strong> <code>CTR</code></li>
<li><strong>Input :</strong> <code>HEX</code></li>
<li><strong>Output :</strong> <code>RAW</code></li>
</ul>
<img width="704" alt="dechiffrement-cyberchef" src="https://gist.github.com/assets/92587864/af7c8e2c-bc6a-4864-9ee6-9aca0bf3f1c3">
<p>Nous pouvons remarquer que le déchiffrement semble bien effectif puisque nous remarquons le header d&rsquo;un fichier ZIP <code>50 4b 03 04</code> correspondant à <code>PK</code> et d&rsquo;autres chaines de caractères telles que :</p>
<ul>
<li><em>_rels/.rels</em></li>
<li><em>docProps/core.xml</em></li>
<li><em>docProps/app.xml</em></li>
<li><em>word/_rels/document.xml.rels</em></li>
<li><em>word/document.xml</em>
<em>[&hellip;]</em></li>
</ul>
<p>Celles-ci nous portent à croire que nous avons à faire à un document Word. Notre fichier serait donc l&rsquo;équivalent de <code>flag.docx</code> que nous avions trouvé lors de la première partie de cette épreuve. Nous pouvons ensuite télécharger le fichier sur notre machine. Ici, nous le nommons <code>flag.zip</code>. Nous pouvons maintenant le dézipper :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ unzip flag.zip                                                            
</span></span><span class="line"><span class="cl">Archive:  flag.zip
</span></span><span class="line"><span class="cl">  inflating: _rels/.rels             
</span></span><span class="line"><span class="cl">  inflating: docProps/core.xml       
</span></span><span class="line"><span class="cl">  inflating: docProps/app.xml        
</span></span><span class="line"><span class="cl">  inflating: word/_rels/document.xml.rels  
</span></span><span class="line"><span class="cl">  inflating: word/document.xml       
</span></span><span class="line"><span class="cl">  inflating: word/styles.xml         
</span></span><span class="line"><span class="cl">  inflating: word/fontTable.xml      
</span></span><span class="line"><span class="cl">  inflating: word/settings.xml       
</span></span><span class="line"><span class="cl">  inflating: <span class="o">[</span>Content_Types<span class="o">]</span>.xml
</span></span></code></pre></td></tr></table>
</div>
</div><p>Le contenu d&rsquo;un fichier word se trouve en général dans le document <code>word/document.xml</code>. Nous pouvons donc utiliser <code>grep</code> pour afficher directement le flag sans s&rsquo;embêter à l&rsquo;ouvrir :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿dragon<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ grep <span class="s2">&#34;ECSC{&#34;</span> word/document.xml 
</span></span><span class="line"><span class="cl"><span class="o">[</span>...<span class="o">]</span>
</span></span><span class="line"><span class="cl">&lt;/w:rPr&gt;&lt;w:t&gt;Flag: ECSC<span class="o">{</span>M4ud1t3_C4mp4gn3_2_r4NC0nG1c13L<span class="o">}</span>&lt;/w:t&gt;&lt;/w:r&gt;&lt;/w:p&gt;&lt;w:sectPr&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>...<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Et voilà ! Le déchiffrement est un succès. Regardons maintenant une autre manière de faire.</p>
<h3 id="déchiffrement-via-python-street-cred" class="headerLink">
    <a href="#d%c3%a9chiffrement-via-python-street-cred" class="header-mark"></a>Déchiffrement via Python <em>(street cred++)</em></h3><p>Pour déchiffrer notre fichier <code>data</code>, nous pouvons également faire appel à notre talent de programmeur (<em>ou appel à notre ami ChatGPT :p</em>). Ayant une plus grande familiarité avec Python, c&rsquo;est avec celui-ci que nous allons pouvoir déchiffrer notre fichier. Cependant, libre à vous de choisir un autre langage de programmation pour cet exercice.</p>
<p>Voici le script <code>decrypt.py</code> en question :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.ciphers</span> <span class="kn">import</span> <span class="n">Cipher</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">modes</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.backends</span> <span class="kn">import</span> <span class="n">default_backend</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">decrypt_file</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Read encrypted content from file</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Extract IV (first 32 characters)</span>
</span></span><span class="line"><span class="cl">    <span class="n">iv</span> <span class="o">=</span> <span class="n">encrypted_content</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The IV of the file is : </span><span class="si">{</span><span class="n">iv</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">encrypted_data</span> <span class="o">=</span> <span class="n">encrypted_content</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Initialize AES-CTR cipher</span>
</span></span><span class="line"><span class="cl">    <span class="n">backend</span> <span class="o">=</span> <span class="n">default_backend</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">modes</span><span class="o">.</span><span class="n">CTR</span><span class="p">(</span><span class="n">iv</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Decrypt the content</span>
</span></span><span class="line"><span class="cl">    <span class="n">decrypted_data</span> <span class="o">=</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">)</span> <span class="o">+</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Write the decrypted content to the output file</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">decrypted_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">input_file</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter the path to the encrypted file: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_file</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter the path for the output file (decrypted content): &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter the AES key: &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="n">decrypt_file</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Decryption completed. Decrypted content saved in &#39;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&#39;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Le principe est simple :</p>
<ul>
<li>Demander à l&rsquo;utilisateur <strong>le chemin du fichier chiffré</strong></li>
<li>Demander à l&rsquo;utilisateur <strong>le chemin et le nom du fichier dans lequel il souhaite mettre le contenu déchiffré</strong></li>
<li>Demander à l&rsquo;utilisateur <strong>la clé de déchiffrement</strong></li>
</ul>
<p>Ensuite, ce script va <strong>extraire automatiquement l&rsquo;IV</strong> du fichier chiffré, l&rsquo;afficher à l&rsquo;utilisateur et enfin déchiffrer son contenu.</p>
<p><em>Il serait intéressant de modifier ce script pour pouvoir déchiffrer tous les fichiers ayant pour extension <code>.chiffré</code> et de nommer ceux-ci par leur nom original (il suffit de décoder leur nom en <code>base64</code>).</em></p>
<p>Voici un exemple d&rsquo;utilisation :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 decrypt.py 
</span></span><span class="line"><span class="cl">Enter the path to the encrypted file: data
</span></span><span class="line"><span class="cl">Enter the path <span class="k">for</span> the output file <span class="o">(</span>decrypted content<span class="o">)</span>: /tmp/flag
</span></span><span class="line"><span class="cl">Enter the AES key: 95511870061fb3a2899aa6b2dc9838aa
</span></span><span class="line"><span class="cl">The IV of the file is : b627d24fc90dfe7ce421c43312dc2f2e
</span></span><span class="line"><span class="cl">Decryption completed. Decrypted content saved in <span class="s1">&#39;/tmp/flag&#39;</span>.
</span></span></code></pre></td></tr></table>
</div>
</div><p>Nous pouvons vérifier le type du fichier à l&rsquo;aide de <code>file</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ file /tmp/flag 
</span></span><span class="line"><span class="cl">/tmp/flag: Microsoft Word 2007+
</span></span></code></pre></td></tr></table>
</div>
</div><p>Le script est fonctionnel puisque la commande détecte bien le fichier déchiffré comme un document Word. Nous pouvons donc le dézipper et utiliser le même <code>grep</code> que précédemment :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿dragon<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ grep <span class="s2">&#34;ECSC{&#34;</span> /tmp/word/document.xml 
</span></span><span class="line"><span class="cl"><span class="o">[</span>...<span class="o">]</span>
</span></span><span class="line"><span class="cl">&lt;/w:rPr&gt;&lt;w:t&gt;Flag: ECSC<span class="o">{</span>M4ud1t3_C4mp4gn3_2_r4NC0nG1c13L<span class="o">}</span>&lt;/w:t&gt;&lt;/w:r&gt;&lt;/w:p&gt;&lt;w:sectPr&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>...<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Nous retrouvons bien notre flag. :D</p>
<h2 id="3-flag-" class="headerLink">
    <a href="#3-flag-" class="header-mark"></a>3. Flag 🚩</h2><p>Nous avons donc réussi à aider notre victime à déchiffrer ses fichiers.</p>
<p>Le flag pour cette dernière épreuve est donc : <code>ECSC{M4ud1t3_C4mp4gn3_2_r4NC0nG1c13L}</code>.</p>
<p>Ce troisième et dernier challenge marque la fin de l&rsquo;épreuve. Je vous remercie d&rsquo;avoir lu mes writeups et espère avoir été assez clair dans mes explications. N&rsquo;hésitez pas à me faire vos retours en me contactant directement sur Discord ou Twitter. ;)</p>
<h2 id="bonus---retrouver-le-flag-sans-le-fichier-data-" class="headerLink">
    <a href="#bonus---retrouver-le-flag-sans-le-fichier-data-" class="header-mark"></a>BONUS - Retrouver le flag sans le fichier <code>data</code> 💡</h2><p>Etant de nature curieuse, j&rsquo;ai voulu voir s&rsquo;il était possible de retrouver le flag directement à l&rsquo;aide du fichier <code>flag.docx</code> chiffré (<em>ZmxhZy5kb2N4.chiffré</em>) à partir du dump mémoire. Pour rappel, nous avions trouvé son adresse virtuelle dans le dump suite à l&rsquo;utilisation du plugin <code>windows.filescan</code> de <strong>Volatility3</strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 ~/Tools/volatility3/vol.py -f mem.dmp windows.filescan <span class="p">|</span> grep <span class="s2">&#34;ZmxhZy5kb2N4&#34;</span> 
</span></span><span class="line"><span class="cl">0xe000123988d0.0<span class="se">\Z</span>mxhZy5kb2N4.chiffré   <span class="m">216</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>De ce fait, j&rsquo;ai ensuite récupéré le fichier à l&rsquo;aide du plugin <code>windows.dumpfiles</code> et de l&rsquo;option <code>--virtaddr</code> suivie de l&rsquo;adresse virtuelle de <code>ZmxhZy5kb2N4.chiffré</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 vol.py -f mem.dmp windows.dumpfiles --virtaddr 0xe000123988d0  
</span></span><span class="line"><span class="cl">Volatility <span class="m">3</span> Framework 2.5.2
</span></span><span class="line"><span class="cl">Progress:  100.00               PDB scanning finished                                
</span></span><span class="line"><span class="cl">Cache   FileObject      FileName        Result
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">DataSectionObject       0xe000123988d0  ZmxhZy5kb2N4.chiffré    file.0xe000123988d0.0xe00010401370.DataSectionObject.ZmxhZy5kb2N4.chiffré.dat
</span></span></code></pre></td></tr></table>
</div>
</div><p>J&rsquo;ai ensuite exécuté mon script Python sur le fichier chiffré :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 decrypt.py 
</span></span><span class="line"><span class="cl">Enter the path to the encrypted file: ZmxhZy5kb2N4.chiffré
</span></span><span class="line"><span class="cl">Enter the path <span class="k">for</span> the output file <span class="o">(</span>decrypted content<span class="o">)</span>: /tmp/flag
</span></span><span class="line"><span class="cl">Enter the AES key: 95511870061fb3a2899aa6b2dc9838aa
</span></span><span class="line"><span class="cl">The IV of the file is : b627d24fc90dfe7ce421c43312dc2f2e
</span></span><span class="line"><span class="cl">Decryption completed. Decrypted content saved in <span class="s1">&#39;/tmp/flag&#39;</span>.
</span></span><span class="line"><span class="cl">                                                                                                                                    
</span></span><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ file /tmp/flag 
</span></span><span class="line"><span class="cl">/tmp/flag: Microsoft Word 2007+
</span></span></code></pre></td></tr></table>
</div>
</div><p>Celui-ci étant bel et bien considéré comme un document Word, je l&rsquo;ai dézippé et j&rsquo;ai utilisé <code>grep</code> pour en extraire le flag :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿dragon<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ grep <span class="s2">&#34;ECSC{&#34;</span> /tmp/word/document.xml 
</span></span><span class="line"><span class="cl"><span class="o">[</span>...<span class="o">]</span>
</span></span><span class="line"><span class="cl">&lt;/w:rPr&gt;&lt;w:t&gt;Flag: ECSC<span class="o">{</span>M4ud1t3_C4mp4gn3_2_r4NC0nG1c13L<span class="o">}</span>&lt;/w:t&gt;&lt;/w:r&gt;&lt;/w:p&gt;&lt;w:sectPr&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>...<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Il est donc possible de résoudre cette dernière épreuve sans s&rsquo;appuyer sur le fichier <code>data</code> ci-joint.</p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Mis à jour le 09-12-2023</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/fr/fcsc-2019-3615-incident-3/index.md target="_blank" rel="noopener noreferrer">Lire en Markdown</a>
                    </span></div>
            <div class="post-info-share"><button title="Partager sur Twitter" data-sharer="twitter" data-url="https://hashp4.fr/fr/fcsc-2019-3615-incident-3/" data-title="[FCSC 2019] - 3615 Incident (3/3)" data-via="hashp4_" data-hashtags="Forensic,FCSC 2019,Volatility,Ransomware"><span class="fab fa-twitter fa-fw"></span></button><button title="Partager sur Linkedin" data-sharer="linkedin" data-url="https://hashp4.fr/fr/fcsc-2019-3615-incident-3/"><span class="fab fa-linkedin fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/fr/tags/forensic/">Forensic</a>,&nbsp;<a href="/fr/tags/fcsc-2019/">FCSC 2019</a>,&nbsp;<a href="/fr/tags/volatility/">Volatility</a>,&nbsp;<a href="/fr/tags/ransomware/">Ransomware</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Retour</a></span>&nbsp;|&nbsp;<span><a href="/fr/">Accueil</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/fr/fcsc-2019-3615-incident-2/" class="prev" rel="prev" title="[FCSC 2019] - 3615 Incident (2/3)"><i class="fas fa-angle-left fa-fw"></i>[FCSC 2019] - 3615 Incident (2/3)</a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Propulsé par <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.121.1">Hugo</a>&nbsp;|&nbsp;Thème - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/fr/" target="_blank" rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank">GPL-V3</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Retour en haut">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="Afficher les commentaires">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/copy-tex.min.css"></noscript><script type="text/javascript">window.config={"code":{"copyTitle":"Copier dans le presse-papiers","maxShownLines":50},"comment":{},"data":{"desktop-header-typeit":"hashp4 (\u003eᴗ•)","mobile-header-typeit":"hashp4 (\u003eᴗ•)"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"}],"strict":false},"sharerjs":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.2/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/copy-tex.min.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>
