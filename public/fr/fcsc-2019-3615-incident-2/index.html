

<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>[FCSC 2019] - 3615 Incident (2/3) - Blog - hashp4</title><meta name="Description" content="Solution du **second** challenge de la série `3615 Incident` paru lors du FCSC 2019."><meta property="og:title" content="[FCSC 2019] - 3615 Incident (2/3)" />
<meta property="og:description" content="Solution du **second** challenge de la série `3615 Incident` paru lors du FCSC 2019." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hashp4.fr/fr/fcsc-2019-3615-incident-2/" /><meta property="og:image" content="https://hashp4.fr/fr/fcsc-2019-3615-incident-2/feature.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-08T00:00:00+00:00" /><meta property="og:site_name" content="hashp4" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://hashp4.fr/fr/fcsc-2019-3615-incident-2/feature.jpg" /><meta name="twitter:title" content="[FCSC 2019] - 3615 Incident (2/3)"/>
<meta name="twitter:description" content="Solution du **second** challenge de la série `3615 Incident` paru lors du FCSC 2019."/>
<meta name="twitter:site" content="@hashp4_"/>
<meta name="application-name" content="hashp4">
<meta name="apple-mobile-web-app-title" content="hashp4">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><meta name="twitter:creator" content="@hashp4_" /><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://hashp4.fr/fr/fcsc-2019-3615-incident-2/" /><link rel="prev" href="https://hashp4.fr/fr/fcsc-2019-3615-incident-1/" /><link rel="next" href="https://hashp4.fr/fr/fcsc-2019-3615-incident-3/" />
<link rel="stylesheet" href="/css/main.4cb370884f3eb79df5ec8943416884c6aa730a30ceff5cd62fd0872f24b6b68e.css" integrity="sha256-TLNwiE8&#43;t5317IlDQWiExqpzCjDO/1zWL9CHLyS2to4="><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/color.728a2655c4cc249649c041d72af6111f81a1b57cb4f99fc4323550b7f966e960.css" integrity="sha256-coomVcTMJJZJwEHXKvYRH4GhtXy0&#43;Z/EMjVQt/lm6WA="><link rel="stylesheet" href="/css/style.min.aadeb0d1e0db9fd05aaaa62285215f80238b1e906367e8936725dd7de8c1642f.css" integrity="sha256-qt6w0eDbn9BaqqYihSFfgCOLHpBjZ&#43;iTZyXdfejBZC8="><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[FCSC 2019] - 3615 Incident (2/3)",
        "inLanguage": "fr",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://hashp4.fr/fr/fcsc-2019-3615-incident-2/"
        },"image": ["https://hashp4.fr/images/Apple-Devices-Preview.png"],"genre": "posts","keywords": "Forensic, FCSC 2019, Volatility, Ransomware","wordcount":  1419 ,
        "url": "https://hashp4.fr/fr/fcsc-2019-3615-incident-2/","datePublished": "2023-12-08T00:00:00+00:00","dateModified": "2023-12-08T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "hashp4","logo": {
                    "@type": "ImageObject",
                    "url": "https://hashp4.fr/images/logo.png",
                    "width":  288 ,
                    "height":  288 
                }},"authors": [{
                        "@type": "Person",
                        "name": "hashp4"                    
                    }],"description": "Solution du **second** challenge de la série `3615 Incident` paru lors du FCSC 2019."
    }
    </script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('black' === 'light' || 'black' === 'dark' || 'black' === 'black') setTheme('black'), saveTheme('black'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/fr/" title="Blog - hashp4"><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/fr/whoami">🇫🇷 whoami </a><a class="menu-item" href="/fr/categories/article/">✒ Blog </a><a class="menu-item" href="/fr/projects/">📚 Projets </a><a class="menu-item" href="/fr/categories/writeup">🚩 Writeups </a><a class="menu-item" href="/fr/music/">🎵 Musique </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="Choisir la langue">Français<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" title="Choisir la langue" id="language-select-desktop" onchange="location = this.value;"><option value="/fcsc-2019-3615-incident-2/">English</option><option value="/fr/fcsc-2019-3615-incident-2/" selected>Français</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-select" title="Changer de thème">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Changer de thème">
                        <option value="light">Clair</option>
                        <option value="dark">Sombre</option>
                        <option value="black">Noir</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/fr/" title="Blog - hashp4"><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/fr/whoami" title="">🇫🇷whoami</a><a class="menu-item" href="/fr/categories/article/" title="">✒Blog</a><a class="menu-item" href="/fr/projects/" title="">📚Projets</a><a class="menu-item" href="/fr/categories/writeup" title="">🚩Writeups</a><a class="menu-item" href="/fr/music/" title="">🎵Musique</a><a href="javascript:void(0);" class="menu-item theme-select" title="Changer de thème">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Changer de thème">
                    <option value="light">Clair</option>
                    <option value="dark">Sombre</option>
                    <option value="black">Noir</option>
                    <option value="auto">Auto</option>
                </select>
            </a><a href="javascript:void(0);" class="menu-item" title="Choisir la langue">Français<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" title="Choisir la langue" onchange="location = this.value;"><option value="/fcsc-2019-3615-incident-2/">English</option><option value="/fr/fcsc-2019-3615-incident-2/" selected>Français</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contenu</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-pushpin">Introduction </a></li>
    <li><a href="#1-analyse-du-code-source-du-rançongiciel-">1. Analyse du code source du rançongiciel 🔬</a>
      <ul>
        <li><a href="#un-zoom-sur-ransomwarego">Un zoom sur <code>ransomware.go</code></a></li>
        <li><a href="#un-zoom-sur-utilsgo">Un zoom sur <code>utils.go</code></a></li>
        <li><a href="#un-zoom-sur-clientgo">Un zoom sur <code>client.go</code></a></li>
        <li><a href="#en-résumé">En résumé&hellip;</a></li>
      </ul>
    </li>
    <li><a href="#2-extraction-de-la-clé-de-chiffrement-">2. Extraction de la clé de chiffrement 🗝</a>
      <ul>
        <li><a href="#grep-for-the-win"><code>grep</code> for the win</a></li>
        <li><a href="#test-des-clés">Test des clés</a></li>
      </ul>
    </li>
    <li><a href="#3-flag-">3. Flag 🚩</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[FCSC 2019] - 3615 Incident (2/3)</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><span class="author fas fa-user-circle fa-fw"></span><span class='screen-reader-text'>  </span><a href='https://hashp4.fr/fr/authors/hashp4'>hashp4</a></span>
                </span>&nbsp;<span class="post-category">inclus dans </span>&nbsp;<span class="post-category">catégorie <a href="/fr/categories/writeup/"><i class="far fa-folder fa-fw"></i>Writeup</a></span>&nbsp;<span class="post-category">et</span>&nbsp;<span class="post-series">séries <a href=""><i class="far fa-list-alt fa-fw"></i></a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="08-12-2023">08-12-2023</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="08-12-2023">08-12-2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1419 mots&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="/fr/fcsc-2019-3615-incident-2/feature.png"
        srcset="/fr/fcsc-2019-3615-incident-2/feature.png, /fr/fcsc-2019-3615-incident-2/feature.png 1.5x, /fr/fcsc-2019-3615-incident-2/feature.png 2x"
        sizes="auto"
        alt="Solution du **second** challenge de la série `3615 Incident` paru lors du FCSC 2019."
        title="Solution du **second** challenge de la série `3615 Incident` paru lors du FCSC 2019." height="360"   width="1200" ></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contenu</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-pushpin">Introduction </a></li>
    <li><a href="#1-analyse-du-code-source-du-rançongiciel-">1. Analyse du code source du rançongiciel 🔬</a>
      <ul>
        <li><a href="#un-zoom-sur-ransomwarego">Un zoom sur <code>ransomware.go</code></a></li>
        <li><a href="#un-zoom-sur-utilsgo">Un zoom sur <code>utils.go</code></a></li>
        <li><a href="#un-zoom-sur-clientgo">Un zoom sur <code>client.go</code></a></li>
        <li><a href="#en-résumé">En résumé&hellip;</a></li>
      </ul>
    </li>
    <li><a href="#2-extraction-de-la-clé-de-chiffrement-">2. Extraction de la clé de chiffrement 🗝</a>
      <ul>
        <li><a href="#grep-for-the-win"><code>grep</code> for the win</a></li>
        <li><a href="#test-des-clés">Test des clés</a></li>
      </ul>
    </li>
    <li><a href="#3-flag-">3. Flag 🚩</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="introduction-pushpin" class="headerLink">
    <a href="#introduction-pushpin" class="header-mark"></a>Introduction &#x1f4cc;</h2><p>Le contexte reste le même que lors de la première partie. Une victime de plus est tombée sous le coup d’un rançongiciel. Le paiement de la rançon n’est pas envisagée vu le montant demandé. Nous sommes donc appelés pour essayer de restaurer les fichiers chiffrés.</p>
<p>Cette fois-ci, l&rsquo;objectif est de <strong>retrouver la clé de chiffrement de ce rançongiciel</strong> !</p>
<p>Note : Réponse attendue au format <code>ECSC{hey.hex()}</code>.</p>
<p>(La résolution de l&rsquo;épreuve s&rsquo;effectue toujours à l&rsquo;aide du fichier <code>mem.dmp.tar.xz</code>. Pour rappel, il s&rsquo;agit d&rsquo;une image mémoire de l&rsquo;ordinateur de la victime. Concrètement, celle-ci correspond au contenu de la mémoire volatile (<code>RAM</code>) au moment de l&rsquo;acquisition et nous allons voir que cela se révèle être une excellente source d&rsquo;informations pour de l&rsquo;investigation numérique.</p>
<h2 id="1-analyse-du-code-source-du-rançongiciel-" class="headerLink">
    <a href="#1-analyse-du-code-source-du-ran%c3%a7ongiciel-" class="header-mark"></a>1. Analyse du code source du rançongiciel 🔬</h2><p>Suite à notre analyse lors de la première partie, nous avons la chance de disposer du code source de ce rançongiciel. Pour rappel, il se trouve ici : <a href="https://github.com/mauri870/ransomware" target="_blank" rel="noopener noreferrer">https://github.com/mauri870/ransomware</a>. Et heureusement, car nous n&rsquo;avions pas tellement envie de reverse du Go, n&rsquo;est-ce pas ? :D</p>
<h3 id="un-zoom-sur-ransomwarego" class="headerLink">
    <a href="#un-zoom-sur-ransomwarego" class="header-mark"></a>Un zoom sur <code>ransomware.go</code></h3><p>Commençons par trouver la manière dont la clé est générée. La fonction <code>encryptFile()</code> dans le fichier <a href="https://github.com/mauri870/ransomware/blob/master/cmd/ransomware/ransomware.go#L112" target="_blank" rel="noopener noreferrer">cmd/ransomware/ransomware.go, à la ligne 112</a> nous permet d&rsquo;en apprendre un peu plus.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">encryptFiles</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">keys</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Generate the id and encryption key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">keys</span><span class="p">[</span><span class="s">&#34;id&#34;</span><span class="p">],</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nf">GenerateRandomANString</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">keys</span><span class="p">[</span><span class="s">&#34;enckey&#34;</span><span class="p">],</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nf">GenerateRandomANString</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Persist the key pair on server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">Client</span><span class="p">.</span><span class="nf">AddNewKeyPair</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="s">&#34;id&#34;</span><span class="p">],</span> <span class="nx">keys</span><span class="p">[</span><span class="s">&#34;enckey&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Nous constatons 2 choses :</p>
<ul>
<li>La génération d&rsquo;un <code>id</code> à l&rsquo;aide de la fonction <code>GenerateRandomANString()</code> située dans le fichier <code>utils</code> et ayant pour paramètre <code>32</code>.</li>
<li>La génération de <code>enckey</code> à l&rsquo;aide de la fonction <code>GenerateRandomANString()</code> située dans le fichier <code>utils</code> et ayant pour paramètre <code>32</code>.</li>
</ul>
<p>Ensuite, ce couple <code>id</code> et <code>enckey</code> est envoyé sur un serveur à l&rsquo;aide de la fonction <code>AddNewKeyPair()</code> située dans le fichier <code>client</code>.</p>
<p>Nous pouvons supposer que l&rsquo;<code>id</code> et la clé de chiffrement <code>enckey</code> (<em>qui est sûrement le diminutif de <code>encrypted key</code></em>) sont tout deux une chaîne de 32 caractères générés aléatoirement. Pour en être sûr, nous pouvons étudier la fonction correspondante.</p>
<h3 id="un-zoom-sur-utilsgo" class="headerLink">
    <a href="#un-zoom-sur-utilsgo" class="header-mark"></a>Un zoom sur <code>utils.go</code></h3><p>Ici, ce qui nous intéresse c&rsquo;est la fonction <code>GenerateRandomANString()</code>, <a href="https://github.com/mauri870/ransomware/blob/master/utils/utils.go#L13" target="_blank" rel="noopener noreferrer">à la ligne 13 de utils/utils.go</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Generate a random alphanumeric string with the given size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">GenerateRandomANString</span><span class="p">(</span><span class="nx">size</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">key</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">hex</span><span class="p">.</span><span class="nf">EncodeToString</span><span class="p">(</span><span class="nx">key</span><span class="p">)[:</span><span class="nx">size</span><span class="p">],</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>La fonction est plutôt simple. Elle prend un entier en paramètre et génère une chaîne de caractère aléatoire de la même taille. Celle-ci est ensuite encodée en hexadécimal à l&rsquo;aide de la fonction <code>hex.EncodeToString()</code> avant d&rsquo;être retournée.</p>
<p>Notre hypothèse est donc confirmée. Nous sommes bien à la recherche d&rsquo;une chaîne de 32 caractères et nous savons qu&rsquo;ils sont hexadécimaux. Mais nous n&rsquo;avons encore aucune piste sur le moyen de récupérer cette fameuse clé&hellip;</p>
<h3 id="un-zoom-sur-clientgo" class="headerLink">
    <a href="#un-zoom-sur-clientgo" class="header-mark"></a>Un zoom sur <code>client.go</code></h3><p>Regardons de plus près la fonction <code>AddNewKeyPair()</code> <a href="https://github.com/mauri870/ransomware/blob/master/client/client.go#L90" target="_blank" rel="noopener noreferrer">dans client/client.go, ligne 90</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// AddNewKeyPair persist a new keypair on server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Client</span><span class="p">)</span> <span class="nf">AddNewKeyPair</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">encKey</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">payload</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">`{&#34;id&#34;: &#34;%s&#34;, &#34;enckey&#34;: &#34;%s&#34;}`</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">encKey</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nf">SendEncryptedPayload</span><span class="p">(</span><span class="s">&#34;/api/keys/add&#34;</span><span class="p">,</span> <span class="nx">payload</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cette fonction prends bien en paramètre un <code>id</code> et une clé de chiffrement <code>enckey</code>. Elle va ensuite mettre en forme la charge utile (<em>payload</em> en anglais) sous la forme :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;l&#39;id associé&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;enckey&#34;</span><span class="p">:</span> <span class="s2">&#34;la clé de chiffrement&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Puis, il sera chiffré et envoyé au serveur de l&rsquo;attaquant par le biais d&rsquo;une API à travers l&rsquo;URI <code>/api/key/add</code> via la fonction <code>SendEncryptedPayload()</code> <em>(je vous laisse le soin d&rsquo;aller regarder cette fonction plus en détail si cela vous intéresse)</em>. Il est donc intéressant de se concentrer sur l&rsquo;envoi de cette charge utile pour retrouver la clé. Il reste peut être encore des traces dans le dump mémoire !</p>
<p><strong>NOTE :</strong> <em>Vous vous demandez peut-être à quoi sert la présence d&rsquo;<code>id</code> ? En règle générale, les opérateurs de rançongiciels n&rsquo;ont pas qu&rsquo;une seule victime. Chacune d&rsquo;entre-elles possède une clé de chiffrement unique et il faut être en mesure des les identifier pour être en mesure de déchiffrer les données en cas de paiement de la rançon. De ce fait, un identifiant unique est attribué à chaque victime et est associé à la bonne clé de chiffrement. Attention, cela s&rsquo;applique uniquement s&rsquo;il y a une volonté de l&rsquo;attaquant à déchiffrer les données. Il n&rsquo;y a absolument <strong>aucune garantie</strong> qu&rsquo;il respecte sa part du marché&hellip;</em></p>
<h3 id="en-résumé" class="headerLink">
    <a href="#en-r%c3%a9sum%c3%a9" class="header-mark"></a>En résumé&hellip;</h3><p>Bien, il est grand temps de faire le résumé de notre analyse. Ce que nous savons à présent :</p>
<ul>
<li>L&rsquo;identifiant unique associé à la clé de chiffrement est une suite aléatoire de 32 caractères hexadécimaux</li>
<li>La clé de chiffrement est également une suite aléatoire de 32 caractères hexadécimaux</li>
<li>Ceux-ci sont envoyés au serveur de l&rsquo;attaquant à travers les paramètres respectifs <code>id</code> et <code>enckey</code> et mis en forme avec le modèle suivant : <code>{&quot;id&quot;: &quot;l'id&quot;, &quot;enckey&quot;: &quot;la clé&quot;}</code></li>
</ul>
<p>Grâce à ces informations, nous pouvons passer à l&rsquo;extraction de cette fameuse clé de chiffrement.</p>
<h2 id="2-extraction-de-la-clé-de-chiffrement-" class="headerLink">
    <a href="#2-extraction-de-la-cl%c3%a9-de-chiffrement-" class="header-mark"></a>2. Extraction de la clé de chiffrement 🗝</h2><p>Nous devons trouver au sein du dump mémoire <em>la clé de chiffrement</em>. Pour ce faire, nous pouvons nous appuyer sur le modèle (ou <em>pattern</em> en anglais) d&rsquo;envoi de la charge utile contenant <code>id</code> et <code>enckey</code> au serveur de l&rsquo;attaquant. Quoi de mieux que <code>grep</code> pour retrouver un pattern dans un fichier ? :)</p>
<h3 id="grep-for-the-win" class="headerLink">
    <a href="#grep-for-the-win" class="header-mark"></a><code>grep</code> for the win</h3><p><code>grep</code> est un outil très intéressant quand il s&rsquo;agit de répérer des pattern au sein d&rsquo;un fichier. Ici, nous allons lui ajouter plusieurs options. La commande finale est la suivante : <code>grep -B 3 -A 3 -wE '{&quot;id&quot;: &quot;\w{32}&quot;, &quot;enckey&quot;:'</code>. Détaillons un peu plus ces options :</p>
<ul>
<li>L&rsquo;option <code>-B 3</code> permet d&rsquo;afficher 3 lignes <strong>avant</strong> la correspondance</li>
<li>L&rsquo;option <code>-A 3</code> permet d&rsquo;afficher 3 lignes <strong>après</strong> la correspondance</li>
<li>L&rsquo;option <code>-wE</code> permet d&rsquo;une part de n&rsquo;afficher que les résultats correspondant exactement au pattern spécifié et d&rsquo;autre part d&rsquo;activer les expressions régulières étendues.</li>
</ul>
<p>Détail de l&rsquo;expression régulière étendue <code>{&quot;id&quot;: &quot;\w{32}&quot;, &quot;enckey&quot;:</code> :</p>
<ul>
<li><code>\w{32}</code> : permet de faire correspondre une chaîne de 32 caractères alphanumériques (avec le caractère <code>_</code> en supplément). C&rsquo;est l&rsquo;équivalent de  <code>[a-zA-Z0-9_]</code></li>
</ul>
<p>Maintenant que notre <code>grep</code> est prêt, nous pouvons l&rsquo;utiliser sur le dump mémoire :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ strings mem.dmp <span class="p">|</span> grep -B <span class="m">3</span> -A <span class="m">3</span> -wE <span class="s1">&#39;{&#34;id&#34;: &#34;\w{32}&#34;, &#34;enckey&#34;:&#39;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;C:\Users\TNKLSAI3TGT7O9\Downloads\assistance.exe&#34;</span> 
</span></span><span class="line"><span class="cl">C:<span class="se">\U</span>sers<span class="se">\T</span>NKLSAI3TGT7O9<span class="se">\D</span>ownloads<span class="se">\a</span>ssistance.exe
</span></span><span class="line"><span class="cl">S-1-5-21-2377780471-3200203716-3353778491-1000
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;id&#34;</span>: <span class="s2">&#34;cd18c00bb476764220d05121867d62de&#34;</span>, <span class="s2">&#34;enckey&#34;</span>: <span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">cd18c00bb476764220d05121867d62de64e0821c53c7d161099be2188b6cac24cd18c00bb476764220d05121867d62de64e0821c53c7d161099be2188b6cac2495511870061fb3a2899aa6b2dc9838aa422d81e7e1c2aa46aa51405c13fed15b95511870061fb3a2899aa6b2dc9838aa422d81e7e1c2aa46aa51405c13fed15b
</span></span></span><span class="line"><span class="cl"><span class="s2">Encrypting C:\Users\Administrateur\Contacts\desktop.ini...
</span></span></span><span class="line"><span class="cl"><span class="s2">C:\Users\TNKLSA~1\AppData\Local\Temp\desktop.ini
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Il se trouve que nous avons belle et bien une correspondance !</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;cd18c00bb476764220d05121867d62de&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;enckey&#34;</span><span class="p">:</span> <span class="err">&#34;cd</span><span class="mi">18</span><span class="err">c</span><span class="mi">00</span><span class="err">bb</span><span class="mi">476764220</span><span class="err">d</span><span class="mi">05121867</span><span class="err">d</span><span class="mi">62</span><span class="err">de</span><span class="mf">64e0821</span><span class="err">c</span><span class="mi">53</span><span class="err">c</span><span class="mi">7</span><span class="err">d</span><span class="mi">161099</span><span class="err">be</span><span class="mi">2188</span><span class="err">b</span><span class="mi">6</span><span class="err">cac</span><span class="mi">24</span><span class="err">cd</span><span class="mi">18</span><span class="err">c</span><span class="mi">00</span><span class="err">bb</span><span class="mi">476764220</span><span class="err">d</span><span class="mi">05121867</span><span class="err">d</span><span class="mi">62</span><span class="err">de</span><span class="mf">64e0821</span><span class="err">c</span><span class="mi">53</span><span class="err">c</span><span class="mi">7</span><span class="err">d</span><span class="mi">161099</span><span class="err">be</span><span class="mi">2188</span><span class="err">b</span><span class="mi">6</span><span class="err">cac</span><span class="mi">2495511870061</span><span class="err">fb</span><span class="mi">3</span><span class="err">a</span><span class="mi">2899</span><span class="err">aa</span><span class="mi">6</span><span class="err">b</span><span class="mi">2</span><span class="err">dc</span><span class="mi">9838</span><span class="err">aa</span><span class="mi">422</span><span class="err">d</span><span class="mf">81e7</span><span class="err">e</span><span class="mi">1</span><span class="err">c</span><span class="mi">2</span><span class="err">aa</span><span class="mi">46</span><span class="err">aa</span><span class="mi">51405</span><span class="err">c</span><span class="mi">13</span><span class="err">fed</span><span class="mi">15</span><span class="err">b</span><span class="mi">95511870061</span><span class="err">fb</span><span class="mi">3</span><span class="err">a</span><span class="mi">2899</span><span class="err">aa</span><span class="mi">6</span><span class="err">b</span><span class="mi">2</span><span class="err">dc</span><span class="mi">9838</span><span class="err">aa</span><span class="mi">422</span><span class="err">d</span><span class="mf">81e7</span><span class="err">e</span><span class="mi">1</span><span class="err">c</span><span class="mi">2</span><span class="err">aa</span><span class="mi">46</span><span class="err">aa</span><span class="mi">51405</span><span class="err">c</span><span class="mi">13</span><span class="err">fed</span><span class="mi">15</span><span class="err">b</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ici, l&rsquo;<code>id</code> a donc pour valeur <code>cd18c00bb476764220d05121867d62de</code>. Cependant, la clé de chiffrement est bien plus grande que prévu. Nous devons donc découper celle-ci en paquet de 32 caractères. Pour ce faire, nous enregistrons manuellement la clé dans un fichier <code>key.txt</code>. Puis, nous pouvons utiliser l&rsquo;utilitaire <code>fold</code> à l&rsquo;aide de l&rsquo;option <code>-b32</code> pour découper notre chaîne de caractère :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>hashp4㉿kali<span class="o">)</span>-<span class="o">[</span>~/Bureau<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ fold -b32 key.txt <span class="p">|</span> sort <span class="p">|</span> uniq
</span></span><span class="line"><span class="cl">422d81e7e1c2aa46aa51405c13fed15b
</span></span><span class="line"><span class="cl">64e0821c53c7d161099be2188b6cac24
</span></span><span class="line"><span class="cl">95511870061fb3a2899aa6b2dc9838aa
</span></span><span class="line"><span class="cl">cd18c00bb476764220d05121867d62de
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>(L&rsquo;utilisation de <code>sort</code> et <code>uniq</code> permet simplement d&rsquo;enlever les paquets de 32 identiques).</em></p>
<p>Nous nous retrouvons avec 4 candidats potentiels. Cela dit, nous remarquons que la dernière clé est en fait identique à l&rsquo;<code>id</code> ! Il ne nous reste que 3 clés à tester. ;)</p>
<h3 id="test-des-clés" class="headerLink">
    <a href="#test-des-cl%c3%a9s" class="header-mark"></a>Test des clés</h3><p>Dans des conditions réelles, nous devrions analyser le code du rançongiciel, prendre connaissance de l&rsquo;algorithme de chiffrement utilisé, dump un fichier chiffré depuis l&rsquo;image mémoire et tenter de le déchiffrer avec chacune des clés potentielles. Cependant, dans le cadre de ce writeup, cela reviendrait à donner la solution pour la dernière étape de cette épreuve&hellip;</p>
<p>De ce fait, et compte-tenu de la faible proportion de clé à évaluer, il nous suffit de les tester une par une en tant que flag jusqu&rsquo;à que celui-ci sois valide.</p>
<ul>
<li>❌ <code>ECSC{422d81e7e1c2aa46aa51405c13fed15b}</code></li>
<li>❌ <code>ECSC{64e0821c53c7d161099be2188b6cac24}</code></li>
<li>✅ <code>ECSC{95511870061fb3a2899aa6b2dc9838aa}</code></li>
</ul>
<h2 id="3-flag-" class="headerLink">
    <a href="#3-flag-" class="header-mark"></a>3. Flag 🚩</h2><p>Grâce à notre analyse (<em>et un trèèèèès léger bruteforce</em>), nous obtenons le flag suivant : <code>ECSC{95511870061fb3a2899aa6b2dc9838aa}</code></p>
<p>Cela marque la conclusion de cette seconde partie du challenge <code>3615 Incident</code>. Dans un premier temps, nous avons pu voir comment était généré la clé de chiffrement et par quel moyen celle-ci était transmise à l&rsquo;attaquant en étudiant le code source du rançongiciel. Dans un second temps, nous avons retrouvé celle associée à notre victime à l&rsquo;aide d&rsquo;une recherche de pattern dans l&rsquo;image mémoire. Il ne vous reste plus que quelques efforts supplémentaires pour réussir la dernière étape de ce challenge. ;)</p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Mis à jour le 08-12-2023</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/fr/fcsc-2019-3615-incident-2/index.md target="_blank" rel="noopener noreferrer">Lire en Markdown</a>
                    </span></div>
            <div class="post-info-share"><button title="Partager sur Twitter" data-sharer="twitter" data-url="https://hashp4.fr/fr/fcsc-2019-3615-incident-2/" data-title="[FCSC 2019] - 3615 Incident (2/3)" data-via="hashp4_" data-hashtags="Forensic,FCSC 2019,Volatility,Ransomware"><span class="fab fa-twitter fa-fw"></span></button><button title="Partager sur Linkedin" data-sharer="linkedin" data-url="https://hashp4.fr/fr/fcsc-2019-3615-incident-2/"><span class="fab fa-linkedin fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/fr/tags/forensic/">Forensic</a>,&nbsp;<a href="/fr/tags/fcsc-2019/">FCSC 2019</a>,&nbsp;<a href="/fr/tags/volatility/">Volatility</a>,&nbsp;<a href="/fr/tags/ransomware/">Ransomware</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Retour</a></span>&nbsp;|&nbsp;<span><a href="/fr/">Accueil</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/fr/fcsc-2019-3615-incident-1/" class="prev" rel="prev" title="[FCSC 2019] - 3615 Incident (1/3)"><i class="fas fa-angle-left fa-fw"></i>[FCSC 2019] - 3615 Incident (1/3)</a>
            <a href="/fr/fcsc-2019-3615-incident-3/" class="next" rel="next" title="[FCSC 2019] - 3615 Incident (3/3)">[FCSC 2019] - 3615 Incident (3/3)<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Propulsé par <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.121.1">Hugo</a>&nbsp;|&nbsp;Thème - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/fr/" target="_blank" rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank">GPL-V3</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Retour en haut">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="Afficher les commentaires">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/copy-tex.min.css"></noscript><script type="text/javascript">window.config={"code":{"copyTitle":"Copier dans le presse-papiers","maxShownLines":50},"comment":{},"data":{"desktop-header-typeit":"hashp4 (\u003eᴗ•)","mobile-header-typeit":"hashp4 (\u003eᴗ•)"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"}],"strict":false},"sharerjs":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.2/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/copy-tex.min.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>
